<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Knowledge Graph</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.1.0/dist/echarts.min.js"></script>
</head>
<body>
<div id="chart" style="width: 100%; height: 1000px;"></div>

<script type="text/javascript">
        var chartData = '{{ chart_data | tojson | safe }}';
        chartData = JSON.parse(chartData);

            var colorPalette = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF'];

            var chartDom = document.getElementById('chart');
            var myChart = echarts.init(chartDom);

            var option = {
                // 工具箱
                toolbox: {
                    // 显示工具箱
                    show: true,
                    feature: {
                        mark: {
                            show: true
                        },
                        // 还原
                        restore: {
                            show: true
                        },
                        // 保存为图片
                        saveAsImage: {
                            show: true
                        }
                    }
                },
                series: [
                    {
                        type: 'graph',
                        layout: 'force',
                        roam: true,
                        symbolSize: 50,
                        draggable: true, // 开启节点的拖拽功能
                        force: {
                            repulsion: 1000,
                            edgeLength: [80, 160],
                            layoutAnimation: true,
                            drag: true, // 启用节点的拖拽功能
                            focusNodeAdjacency: true, // 拖拽节点时的邻接节点高亮
                            preventOverlap: true, // 拖拽节点时防止重叠
                            seriesDraggable: true // 设置系列是否能被拖拽
                        },
                        label: {
                            show: true,
                            fontSize: 16,
                            formatter: function(params) {
                                return params.data.id;
                            },
                            position: 'inside',
                            distance: 10,
                            draggable: true, // 添加draggable属性
                        },
                        edgeSymbol: ['none', 'none'],
                        edgeSymbolSize: [0, 0],
                        edgeLabel: {
                            fontSize: 12 // 添加edgeLabel对象
                        },
                        data: chartData.nodes,
                        links: chartData.links,
                        emphasis: {
                            focus: 'adjacency',
                            lineStyle: {
                                width: 10
                            }
                        },
                        lineStyle: {
                            curveness: 0.2
                        },
                        itemStyle: {
                            color: function (params) {
                                return colorPalette[params.data.group % colorPalette.length];
                            }
                        }
                    }
                ]
            };

            myChart.setOption(option);

</script>
</body>
</html>